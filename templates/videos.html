{% extends "base.html" %}

{% block title %}Video Gallery{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">Video Gallery</h1>
    
    <!-- Debug Information -->
    <div class="debug-info">
        <h3>Debug Info:</h3>
        <p>Number of videos: {{ videos|length if videos else 0 }}</p>
        <p>Bucket name: {{ bucket_name }}</p>
        <pre>{{ videos|tojson(indent=2) if videos else 'No videos' }}</pre>
    </div>

    {% if videos %}
        <div class="video-gallery">
            {% for video_id, video in videos.items() %}
                <div class="video-item">
                    <div class="video-container">
                        {% if video.url %}
                            <video width="100%" controls>
                                <source src="{{ video.url }}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        {% else %}
                            <img class="video-thumbnail" 
                                 src="https://storage.googleapis.com/{{ bucket_name }}/thumbnails/{{ video.title }}" 
                                 alt="{{ video.title }}"
                                 onerror="this.src='/static/images/fallback-thumbnail.jpg'">
                        {% endif %}
                    </div>
                    <div class="video-content">
                        <h3 class="video-title">{{ video.title }}</h3>
                        <a href="{{ url_for('video_page', video_name=video_id) }}" 
                           class="watch-button">Watch Video</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-videos">
            <p>No videos available.</p>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Log video data
        console.log('Videos data:', {{ videos|tojson if videos else '{}' }});
        
        // Monitor video loading errors
        const videos = document.getElementsByTagName('video');
        for(let video of videos) {
            video.addEventListener('error', function(e) {
                console.error('Error loading video:', e);
                console.error('Video source:', this.getElementsByTagName('source')[0].src);
            });
        }

        // Monitor thumbnail loading errors
        const thumbnails = document.getElementsByClassName('video-thumbnail');
        for(let thumbnail of thumbnails) {
            thumbnail.addEventListener('error', function(e) {
                console.error('Error loading thumbnail:', e);
                console.error('Thumbnail source:', this.src);
            });
        }
    });
</script>
{% endblock %}